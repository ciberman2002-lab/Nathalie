---
// src/pages/index.astro
import '../styles/global.css';
import Header from '../components/Header';
import Hero from '../components/Hero';
import Expertise from '../components/Expertise';
import About from '../components/About';
import Insights from '../components/Insights';
import FAQ from '../components/FAQ';
import Contact from '../components/Contact';
import Footer from '../components/Footer';
import CookieBanner from '../components/CookieBanner';
import WhatsAppButton from '../components/WhatsAppButton';

import { getAllArticles } from '../utils/keystatic-reader'; // ajuste o caminho se necessário

// Leitura dos artigos reais no server-side
const allPosts = await getAllArticles();

const last3Posts = allPosts.slice(0, 3);
---
<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <title>Dra. Nathalie Almeida | Advogada em Presidente Dutra e Irecê - Bahia</title>
    
    <meta name="description" content="Advogada em Presidente Dutra - BA. Dra. Nathalie Almeida: especialista em Direito do Trabalho, Sucessões e soluções extrajudiciais. Atendimento em toda região." />
    
    <meta name="viewport" content="width=device-width" />
    <meta name="theme-color" content="#640d14">
    
    <link rel="canonical" href="https://www.seusite.com.br/" />

    <meta property="og:type" content="website" />
    <meta property="og:title" content="Dra. Nathalie Almeida | Advocacia Especializada" />
    <meta property="og:description" content="Soluções jurídicas personalizadas com foco em excelência e transparência. Conheça a atuação da Dra. Nathalie Almeida." />
    <meta property="og:image" content="/og-image.jpg" /> <meta property="og:url" content="https://www.seusite.com.br/" />

    <link rel="icon" type="image/svg+xml" href="/Nathalie_logo_SVG.svg">
    <link rel="preload" href="/fonts/cinzel-v26-latin-regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    <link rel="preload" href="/fonts/montserrat-v25-latin-regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  </head>
  <body class="bg-[#fdfbf7] selection:bg-[#4a0404] selection:text-white overflow-x-hidden">
    
    <Header client:idle />
    
    <main>
      <Hero client:load />
      <Expertise client:visible />
      <About client:visible />
      <Insights client:visible posts={last3Posts} />
      <FAQ client:visible />
<!-- <Contact client:visible /> -->
    </main>

    <Footer />
    <CookieBanner client:idle />
    <WhatsAppButton client:idle />

<script is:inline>
  // Função para scroll suave com offset
  function scrollToSection(sectionId) {
    const element = document.getElementById(sectionId);
    if (element) {
      const offset = 100;
      const elementPosition = element.getBoundingClientRect().top + window.scrollY;
      window.scrollTo({
        top: elementPosition - offset,
        behavior: 'smooth'
      });
      // Limpa URL
      history.replaceState(null, '', window.location.pathname);
    }
  }

  // Verifica parâmetro na URL
  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const section = urlParams.get('section');

    if (section) {
      // Tenta scroll imediato
      scrollToSection(section);

      // Observer para caso a seção seja carregada depois (lazy ou client:visible)
      const observer = new MutationObserver(() => {
        scrollToSection(section);
      });

      observer.observe(document.body, {
        childList: true,
        subtree: true
      });

      // Timeout de segurança (remove observer após 5s)
      setTimeout(() => observer.disconnect(), 5000);
    }
  });
</script>
  </body>
</html>
